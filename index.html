<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no"
/>
  <title>–ú–µ–¥–∏—Ç–∞—Ü–∏—è –∏ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0d0b12">
  <style>
    :root{
      --bg:#0d0b12;
      --card:#16141e;
      --muted:#bdbcc7;
      --text:#ffffff;
      --acc:#6a5cff;
      --radius:22px;
      --shadow:0 10px 40px rgba(0,0,0,.45);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;background:radial-gradient(1200px 800px at 70% -10%, #3b2a63 0%, #1a1525 40%, #0d0b12 100%);color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro Display", Inter, Arial; margin:0}
    /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ¬´—ç–∫—Ä–∞–Ω–∞¬ª –≤ —Å—Ç–∏–ª–µ –∞–π—Ñ–æ–Ω–∞ */
    .app{
      position:fixed; inset:0;
      padding:calc(20px + var(--safe-top)) calc(16px + var(--safe-right)) calc(20px + var(--safe-bottom)) calc(16px + var(--safe-left));
      display:flex; overflow:hidden;
    }
    .screen{
      min-width:100%;
      flex:0 0 100%;
      padding:8px;
      display:flex; flex-direction:column; gap:18px;
      transition:transform .5s cubic-bezier(.2,.8,.2,1);
    }
    .carousel{ display:flex; width:300%; transform:translateX(0); }

    /* –æ–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .greet{font-size:36px; line-height:1.1; font-weight:700; letter-spacing:-.02em}
    .muted{color:var(--muted)}
    .chip{padding:10px 14px; border-radius:999px; background:#221e2f; font-size:14px}
    .btn{
      border:0; outline:0; cursor:pointer;
      padding:14px 18px; border-radius:16px;
      background:#ffffff10; color:#fff; font-weight:600; font-size:16px;
      box-shadow:var(--shadow)
    }
    .btn:active{transform:translateY(1px); opacity:.95}
    .fab{
      position:fixed; right:calc(16px + var(--safe-right)); bottom:calc(24px + var(--safe-bottom));
      width:64px; height:64px; border-radius:32px; display:grid; place-items:center;
      background:#ffffff; color:#000; font-weight:700; box-shadow:0 12px 50px rgba(0,0,0,.55)
    }
    /* –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –º—è–≥–∫–∏–º–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏ */
    .card{
      background:linear-gradient(135deg,#201b2c 0%, #171423 60%);
      border-radius:var(--radius);
      padding:18px; box-shadow:var(--shadow); position:relative; overflow:hidden
    }
    .blob{
      position:absolute; inset:auto; width:240px; height:240px; border-radius:50%;
      filter:blur(30px); opacity:.65; pointer-events:none;
      background:conic-gradient(from 180deg,#6d6bff, #9c67ff, #ffb86b, #ff6aa5, #6d6bff);
      transform:translate(40px, -60px) rotate(20deg);
    }
    .blob.small{width:160px;height:160px; transform:translate(120px, 20px) rotate(-15deg)}
    .title-lg{font-size:44px; line-height:1.05; letter-spacing:-.02em; font-weight:800}
    .subtitle{font-size:18px; color:var(--muted)}

    /* –≠–∫—Ä–∞–Ω 1 ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ */
    .start-cta{
      margin-top:auto;display:flex; justify-content:flex-end;
    }
    .start-cta .go{
      width:80px;height:80px;border-radius:40px;background:#fff;color:#000;
      display:grid; place-items:center; font-size:28px; box-shadow:var(--shadow)
    }

    /* –≠–∫—Ä–∞–Ω 2 ‚Äî –º–µ–¥–∏—Ç–∞—Ü–∏—è */
    .breath{
      background:#14121e; border-radius:var(--radius); padding:20px; display:flex; flex-direction:column; gap:12px; align-items:center
    }
    .circle{
      width:240px; height:240px; border-radius:50%;
      background:radial-gradient(100% 100% at 30% 30%, #fff8 0%, #ffffff15 60%, #ffffff05 100%), 
                 conic-gradient(from 90deg, #7d69ff, #ffcc70, #ffa0d0, #7d69ff);
      box-shadow:0 30px 80px rgba(86,69,255,.25), inset 0 0 40px #fff2;
      transition:transform 3.5s ease-in-out;
    }
    .circle.grow{ transform:scale(1.25) }
    .timer{font-size:48px; font-weight:800}
    .hint{font-size:16px; color:var(--muted)}

    /* –≠–∫—Ä–∞–Ω 3 ‚Äî –∫–∞–ª–µ–Ω–¥–∞—Ä—å */
    .cal{
      background:#14121e; padding:18px; border-radius:var(--radius)
    }
    .cal .grid{
      margin-top:10px;
      display:grid; grid-template-columns: repeat(7, 1fr); gap:8px; text-align:center
    }
    .dow{color:#9c99ad; font-size:12px}
    .day{
      aspect-ratio:1/1; border-radius:14px; display:grid; place-items:center;
      background:#1b1826; font-weight:600; position:relative
    }
    .day.today{outline:2px solid #ffffff; outline-offset:-2px}
    .dot{ position:absolute; bottom:6px; width:8px; height:8px; border-radius:4px }
    .mood-good{ background:#7CFF7A }
    .mood-ok{ background:#FFD56A }
    .mood-bad{ background:#FF6A88 }
    .editor{display:flex; flex-direction:column; gap:12px}
    .mood-row{display:flex; gap:10px}
    .mood{
      flex:1; padding:14px; border-radius:14px; background:#1e1a2a; text-align:center; font-size:22px
    }
    textarea{
      width:100%; min-height:88px; resize:none; border-radius:14px; border:0; padding:12px;
      background:#1e1a2a; color:#fff; font-size:16px; outline:none
    }
    .save{background:#fff; color:#000}

    /* –∞–¥–∞–ø—Ç–∏–≤ –¥–ª—è ¬´–∞–π—Ñ–æ–Ω-16¬ª (–≤—ã—Å–æ–∫–∏–π —ç–∫—Ä–∞–Ω) */
    @media (min-height: 820px){
      .title-lg{font-size:52px}
      .circle{width:280px;height:280px}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="carousel" id="carousel" style="transform:translateX(0)">
      <!-- –≠–∫—Ä–∞–Ω 1: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
      <section class="screen" aria-label="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ">
        <div class="row">
          <div class="chip">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ</div>
          <div class="chip">–°–µ–≥–æ–¥–Ω—è: <span id="todayStr">‚Äî</span></div>
        </div>

        <div class="card">
          <div class="blob"></div><div class="blob small"></div>
          <div class="title-lg">–£—á–∏–º—Å—è –¥—ã—à–∞—Ç—å<br/>–∏ –±—ã—Ç—å <span style="font-weight:900">—Å–ø–æ–∫–æ–π–Ω–µ–µ</span></div>
          <p class="subtitle">–ù–∞–∂–º–∏—Ç–µ ¬´‚Üí¬ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é –º–µ–¥–∏—Ç–∞—Ü–∏—é, –∞ –∑–∞—Ç–µ–º –æ—Ç–º–µ—Ç—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ.</p>
        </div>

        <div class="row">
          <div class="card" style="flex:1">
            <div class="subtitle">–ë—ã—Å—Ç—Ä–∞—è —Å–µ—Å—Å–∏—è</div>
            <div class="greet">3‚Äì5 –º–∏–Ω</div>
          </div>
          <div class="card" style="flex:1">
            <div class="subtitle">–†–µ–∂–∏–º</div>
            <div class="greet">–í–¥–æ—Ö 4 ‚Ä¢ –ü–∞—É–∑–∞ 2 ‚Ä¢ –í—ã–¥–æ—Ö 6</div>
          </div>
        </div>

        <div class="start-cta">
          <button class="go" id="toMeditation" aria-label="–ù–∞—á–∞—Ç—å">‚Üí</button>
        </div>
      </section>

      <!-- –≠–∫—Ä–∞–Ω 2: –ú–µ–¥–∏—Ç–∞—Ü–∏—è -->
      <section class="screen" aria-label="–ú–µ–¥–∏—Ç–∞—Ü–∏—è">
        <div class="row">
          <button class="btn" id="back1">‚Üê</button>
          <div class="chip">–ú–µ–¥–∏—Ç–∞—Ü–∏—è –¥—ã—Ö–∞–Ω–∏—è</div>
          <button class="btn" id="toCalendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Üí</button>
        </div>

        <div class="breath card" style="margin-top:12px">
          <div class="circle" id="circle" aria-live="polite"></div>
          <div class="timer" id="timer">03:00</div>
          <div class="hint" id="phase">–ì–æ—Ç–æ–≤—ã? –ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª</div>
          <div class="row" style="gap:10px">
            <button class="btn" id="start">–°—Ç–∞—Ä—Ç</button>
            <button class="btn" id="pause">–ü–∞—É–∑–∞</button>
            <button class="btn" id="reset">–°–±—Ä–æ—Å</button>
          </div>
        </div>

        <div class="card">
          <div class="subtitle">–ü–æ–¥—Å–∫–∞–∑–∫–∞</div>
          <div>–î—ã—à–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–æ—Å. –°–ª–µ–¥—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º: <b>–≤–¥–æ—Ö 4—Å</b> ‚Üí <b>–ø–∞—É–∑–∞ 2—Å</b> ‚Üí <b>–≤—ã–¥–æ—Ö 6—Å</b>. –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏.</div>
        </div>
      </section>

      <!-- –≠–∫—Ä–∞–Ω 3: –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ -->
      <section class="screen" aria-label="–ö–∞–ª–µ–Ω–¥–∞—Ä—å">
        <div class="row">
          <button class="btn" id="back2">‚Üê</button>
          <div class="chip">–í–∞—à –∫–∞–ª–µ–Ω–¥–∞—Ä—å</div>
          <div class="chip" id="monthLabel">‚Äî</div>
        </div>

        <div class="cal card">
          <div class="row"><div class="subtitle">–û—Ç–º–µ—Ç—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
            <div class="row">
              <button class="btn" id="prevM">‚Äπ</button>
              <button class="btn" id="nextM">‚Ä∫</button>
            </div>
          </div>

          <div class="grid" id="dow">
            <div class="dow">–ü–ù</div><div class="dow">–í–¢</div><div class="dow">–°–†</div>
            <div class="dow">–ß–¢</div><div class="dow">–ü–¢</div><div class="dow">–°–ë</div><div class="dow">–í–°</div>
          </div>
          <div class="grid" id="days"></div>
        </div>

        <div class="card editor">
          <div class="subtitle">–°–µ–≥–æ–¥–Ω—è: <span id="selectedDate">‚Äî</span></div>
          <div class="mood-row">
            <button class="mood" data-mood="good">üòä –•–æ—Ä–æ—à–æ</button>
            <button class="mood" data-mood="ok">üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
            <button class="mood" data-mood="bad">üòû –ü–ª–æ—Ö–æ</button>
          </div>
          <textarea id="note" placeholder="–ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
          <button class="btn save" id="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </section>
    </div>

    <!-- –ø–ª–∞–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ —Å–≤–∞–π–ø—ã -->
    <div class="fab" id="hintFab" title="–°–≤–∞–π–ø–∞–π—Ç–µ">
      ‚Üî
    </div>
  </div>

<script>
  // ---------------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ ----------------
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const state = {
    screen: 0,
    timerSec: 180,
    running: false,
    phase: 'idle', // inhale/hold/exhale
    monthOffset: 0, // 0 = —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
    selected: new Date(),
  };

  const fmt2 = n => String(n).padStart(2,'0');
  const fmtTime = s => `${fmt2(Math.floor(s/60))}:${fmt2(s%60)}`;
  const ymd = d => {
    const z = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    return `${z.getFullYear()}-${fmt2(z.getMonth()+1)}-${fmt2(z.getDate())}`;
  };
  const todayStr = new Date().toLocaleDateString('ru-RU', {weekday:'long', day:'numeric', month:'long'});
  $('#todayStr').textContent = todayStr.charAt(0).toUpperCase()+todayStr.slice(1);

  // ---------------- –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Å–≤–∞–π–ø—ã ----------------
  const carousel = $('#carousel');
  function go(i){
    state.screen = Math.max(0, Math.min(2, i));
    carousel.style.transform = `translateX(-${state.screen*100}%)`;
    $('#hintFab').style.display = (state.screen===0)?'grid':'none';
  }
  $('#toMeditation').onclick = ()=>go(1);
  $('#toCalendar').onclick  = ()=>go(2);
  $('#back1').onclick = ()=>go(0);
  $('#back2').onclick = ()=>go(1);

  // —Å–≤–∞–π–ø—ã
  let x0=null, locked=false;
  function unify(e){ return e.changedTouches? e.changedTouches[0] : e }
  app.addEventListener('touchstart', e => { x0 = unify(e).clientX }, {passive:true});
  app.addEventListener('touchmove', e => {
    if(!x0 || locked) return;
    const dx = unify(e).clientX - x0;
    if(Math.abs(dx)>60){
      locked = true;
      if(dx<0) go(state.screen+1); else go(state.screen-1);
      setTimeout(()=>locked=false, 350);
    }
  }, {passive:true});
  app.addEventListener('touchend', ()=> x0=null);

  // ---------------- –ú–µ–¥–∏—Ç–∞—Ü–∏—è: –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–π —Ç–∞–π–º–µ—Ä ----------------
  const T_IN=4, T_HOLD=2, T_OUT=6; // —Å–µ–∫—É–Ω–¥—ã
  let tInterval=null, phaseT=0;
  const circle=$('#circle'), timer=$('#timer'), phase=$('#phase');

  function setPhase(p){
    state.phase=p; phaseT = (p==='inhale'?T_IN : p==='hold'?T_HOLD : T_OUT);
    phase.textContent = p==='inhale'?'–í–¥–æ—Ö–Ω–∏—Ç–µ‚Ä¶'
      : p==='hold' ? '–ó–∞–¥–µ—Ä–∂–∏—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ‚Ä¶'
      : '–ú–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥—ã—Ö–∞–π—Ç–µ‚Ä¶';
    circle.classList.toggle('grow', p!=='exhale'); // –Ω–∞ –≤—ã–¥–æ—Ö ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
  }

  function nextPhase(){
    if(state.phase==='idle') setPhase('inhale');
    else if(state.phase==='inhale') setPhase('hold');
    else if(state.phase==='hold') setPhase('exhale');
    else setPhase('inhale');
  }

  function tick(){
    if(!state.running) return;
    if(state.timerSec<=0){ stop(); phase.textContent='–ì–æ—Ç–æ–≤–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.'; return; }
    timer.textContent = fmtTime(state.timerSec);
    if(--phaseT<=0) nextPhase();
    state.timerSec--;
  }
  function start(){
    if(state.running) return;
    state.running=true; if(state.phase==='idle') nextPhase();
    tInterval = setInterval(tick, 1000);
  }
  function stop(){ state.running=false; clearInterval(tInterval); }
  function reset(){ stop(); state.timerSec=180; state.phase='idle'; timer.textContent=fmtTime(state.timerSec); phase.textContent='–ì–æ—Ç–æ–≤—ã? –ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª'; circle.classList.remove('grow') }

  $('#start').onclick=start; $('#pause').onclick=stop; $('#reset').onclick=reset;
  timer.textContent = fmtTime(state.timerSec);

  // ---------------- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ----------------
  const monthLabel = $('#monthLabel');
  const daysWrap = $('#days');
  const selectedDateLabel = $('#selectedDate');
  const noteEl = $('#note');

  function loadMood(key){ try{ return JSON.parse(localStorage.getItem('mood:'+key)||'{}'); }catch(e){ return {}; } }
  function saveMood(key, obj){ localStorage.setItem('mood:'+key, JSON.stringify(obj)); }

  function monthInfo(offset){
    const base = new Date();
    const year = base.getFullYear(), month = base.getMonth()+offset;
    const d = new Date(year, month, 1);
    const firstDow = (d.getDay()+6)%7; // –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫=0
    const days = new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
    return {d, firstDow, days};
  }

  function paintMonth(){
    const {d, firstDow, days} = monthInfo(state.monthOffset);
    monthLabel.textContent = d.toLocaleDateString('ru-RU',{month:'long', year:'numeric'});
    daysWrap.innerHTML='';
    // –ø—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏ –¥–æ 1-–≥–æ —á–∏—Å–ª–∞
    for(let i=0;i<firstDow;i++){ const s=document.createElement('div'); daysWrap.appendChild(s); }
    const todayKey = ymd(new Date());
    for(let day=1; day<=days; day++){
      const cell=document.createElement('button');
      cell.className='day';
      const thisDate = new Date(d.getFullYear(), d.getMonth(), day);
      const key = ymd(thisDate);
      cell.textContent = day;
      if(key===todayKey) cell.classList.add('today');

      // —Ç–æ—á–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
      const stored = loadMood(key);
      if(stored.mood){
        const dot=document.createElement('div'); dot.className='dot';
        dot.classList.add(stored.mood==='good'?'mood-good':stored.mood==='ok'?'mood-ok':'mood-bad');
        cell.appendChild(dot);
      }
      cell.onclick=()=>{
        state.selected=thisDate;
        selectedDateLabel.textContent=thisDate.toLocaleDateString('ru-RU',{day:'numeric', month:'long', year:'numeric'});
        noteEl.value= (stored.note||'');
        // –ø–æ–¥—Å–≤–µ—Ç–∏–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É —Å–ª–µ–≥–∫–∞ —É–º–µ–Ω—å—à–∞—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        [...daysWrap.querySelectorAll('.day')].forEach(d=>d.style.opacity='.6');
        cell.style.opacity='1';
      }
      daysWrap.appendChild(cell);
    }
    // –≤—ã–±—Ä–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const todayButton = daysWrap.querySelector('.day.today');
    if(todayButton) todayButton.click();
  }

  $('#prevM').onclick = ()=>{ state.monthOffset--; paintMonth(); }
  $('#nextM').onclick = ()=>{ state.monthOffset++; paintMonth(); }
  selectedDateLabel.textContent = new Date().toLocaleDateString('ru-RU',{day:'numeric', month:'long', year:'numeric'});

  // –≤—ã–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
  $$('.mood').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      $$('.mood').forEach(b=>b.style.outline='none');
      btn.style.outline='2px solid #fff';
      btn.dataset.active='1';
      // –≤—Ä–µ–º–µ–Ω–Ω–æ —Ö—Ä–∞–Ω–∏–º –Ω–∞ –∫–Ω–æ–ø–∫–µ
      $('#save').dataset.mood = btn.getAttribute('data-mood');
    });
  });

  $('#save').onclick = ()=>{
    const key = ymd(state.selected);
    const mood = $('#save').dataset.mood || 'ok';
    const note = noteEl.value.trim();
    saveMood(key, {mood, note});
    paintMonth();
    alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ');
  };

  // –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
  paintMonth();

  // –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ –Ω–∞ GitHub Pages) + –ø–æ–¥—Å–∫–∞–∑–∫–∞
  document.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight') go(state.screen+1);
    if(e.key==='ArrowLeft') go(state.screen-1);
    if(e.key===' ') start();
  });
</script>
</body>
</html>
