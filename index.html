<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, viewport-fit=cover,
                 maximum-scale=1, user-scalable=no">
  <title>–ú–µ–¥–∏—Ç–∞—Ü–∏—è ¬∑ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0e0b14">

  <style>
    :root{
      --bg:#0e0b14;
      --bg2:#171425;
      --card:#1a1728;
      --text:#fff;
      --muted:#bdbcc7;
      --radius:26px;
      --shadow:0 16px 60px rgba(0,0,0,.45);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
    }
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%;margin:0;color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Inter,system-ui,Arial}
    body{
      background:
        radial-gradient(900px 700px at 85% -10%, #3a2a62 0%, #1d1830 45%, #0e0b14 100%),
        linear-gradient(#0e0b14,#0e0b14);
    }

    /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –≤—ã—Ä–µ–∑–∞ –∏ home-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ */
    .app{
      position:fixed; inset:0;
      padding:calc(18px + var(--safe-top))
               calc(16px + var(--safe-right))
               calc(18px + var(--safe-bottom))
               calc(16px + var(--safe-left));
      overflow:hidden; display:flex;
    }

    /* –∫–∞—Ä—É—Å–µ–ª—å –∏–∑ —Ç—Ä—ë—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    .carousel{display:flex; width:300%; transition:transform .55s cubic-bezier(.2,.8,.2,1)}
    .screen{min-width:100%; padding:6px; display:flex; flex-direction:column; gap:18px}

    .chip{display:inline-block; padding:10px 14px; border-radius:999px;
      background:#211c30; color:#d4d2df; font-size:14px}
    .title{
      font-size:44px; line-height:1.02; font-weight:900; letter-spacing:-.02em;
      background:linear-gradient(90deg,#ffffff, #ffd4b0 30%, #f0b0ff 60%, #ffffff 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      margin:8px 0 6px 0;
    }
    .subtitle{color:var(--muted); font-size:18px}

    .card{
      position:relative; overflow:hidden; border-radius:var(--radius);
      background:linear-gradient(135deg,var(--card) 0%, #151224 60%);
      padding:20px; box-shadow:var(--shadow)
    }
    .blob,.blob2{
      position:absolute; border-radius:50%; filter:blur(28px); opacity:.7; pointer-events:none
    }
    .blob{width:320px; height:320px; right:-80px; top:-60px;
      background:conic-gradient(from 180deg,#7a70ff, #ffa963, #ff6ab1, #7a70ff)}
    .blob2{width:200px; height:200px; left:-60px; bottom:-40px;
      background:conic-gradient(from 0deg,#6f66ff,#8fcaff,#b38bff,#6f66ff)}

    .row{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .btn{
      border:0; outline:0; cursor:pointer; border-radius:16px; padding:14px 18px;
      background:#ffffff12; color:#fff; font-weight:600; font-size:16px;
    }
    .btn:active{transform:translateY(1px); opacity:.95}

    .pill{border-radius:14px; padding:12px 14px; background:#19162a; font-weight:700; font-size:28px}

    /* –±–æ–ª—å—à–∞—è –∫—Ä—É–≥–ª–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–¥–∞–ª–µ–µ¬ª —Å–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞ */
    .fab{
      position:fixed; right:calc(18px + var(--safe-right));
      bottom:calc(26px + var(--safe-bottom));
      width:76px; height:76px; border-radius:50%;
      display:grid; place-items:center; background:#fff; color:#000;
      font-size:28px; box-shadow:0 16px 60px rgba(0,0,0,.55); z-index:10
    }

    /* —ç–∫—Ä–∞–Ω 2 ‚Äî –¥—ã—Ö–∞–Ω–∏–µ */
    .breath{display:flex; flex-direction:column; align-items:center; gap:12px}
    .circle{
      width:260px; height:260px; border-radius:50%;
      background:
        radial-gradient(90% 90% at 30% 30%, #fff7 0%, #ffffff18 60%, #ffffff08 100%),
        conic-gradient(from 90deg,#7d69ff,#ffcc70,#ffa0d0,#7d69ff);
      box-shadow:0 28px 90px rgba(86,69,255,.28), inset 0 0 40px #fff2;
      transition:transform 3.5s ease-in-out;
    }
    .circle.grow{transform:scale(1.25)}
    .timer{font-size:52px; font-weight:900}
    .hint{font-size:16px; color:var(--muted)}

    /* —ç–∫—Ä–∞–Ω 3 ‚Äî –∫–∞–ª–µ–Ω–¥–∞—Ä—å */
    .cal{background:#151224; border-radius:var(--radius); padding:18px}
    .grid{display:grid; grid-template-columns:repeat(7,1fr); gap:8px; margin-top:10px}
    .dow{color:#9f9bb0; font-size:12px; text-align:center}
    .day{
      aspect-ratio:1/1; border-radius:16px; display:grid; place-items:center;
      background:#1b1828; font-weight:700; position:relative;
    }
    .day.today{outline:2px solid #fff; outline-offset:-2px}
    .dot{position:absolute; bottom:6px; width:8px; height:8px; border-radius:50%}
    .mood-good{background:#7CFF7A}
    .mood-ok{background:#FFD56A}
    .mood-bad{background:#FF6A88}
    .editor{display:flex; flex-direction:column; gap:12px}
    .mood-row{display:flex; gap:10px}
    .mood{flex:1; padding:14px; border-radius:14px; background:#1f1a2d; text-align:center; font-size:22px}
    textarea{
      width:100%; min-height:88px; resize:none; border-radius:14px; border:0; padding:12px;
      background:#1f1a2d; color:#fff; font-size:16px; outline:none
    }
    .save{background:#fff; color:#000; font-weight:800}

    /* –Ω–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–º —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫—É –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (iPhone 15/16) */
    @media (min-height: 820px){
      .title{font-size:50px}
      .circle{width:300px;height:300px}
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="carousel" id="carousel">
      <!-- –≠–∫—Ä–∞–Ω 1: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
      <section class="screen" aria-label="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ">
        <div class="chip">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ</div>

        <div class="card">
          <div class="blob"></div><div class="blob2"></div>
          <div class="title">–£—á–∏–º—Å—è –¥—ã—à–∞—Ç—å<br/>–∏ –±—ã—Ç—å —Å–ø–æ–∫–æ–π–Ω–µ–µ</div>
          <div class="subtitle">–ù–∞–∂–º–∏—Ç–µ –∫—Ä—É–≥–ª—É—é –∫–Ω–æ–ø–∫—É —Å–Ω–∏–∑—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å–µ—Å—Å–∏—é, –∑–∞—Ç–µ–º –æ—Ç–º–µ—Ç—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ.</div>
        </div>

        <div class="card">
          <div class="subtitle">–ë—ã—Å—Ç—Ä–∞—è —Å–µ—Å—Å–∏—è</div>
          <div class="pill">3‚Äì5 –º–∏–Ω</div>
        </div>
      </section>

      <!-- –≠–∫—Ä–∞–Ω 2: –º–µ–¥–∏—Ç–∞—Ü–∏—è -->
      <section class="screen" aria-label="–ú–µ–¥–∏—Ç–∞—Ü–∏—è">
        <div class="row">
          <button class="btn" id="back1">‚Üê –ù–∞–∑–∞–¥</button>
          <span class="chip">–î—ã—Ö–∞–Ω–∏–µ 4‚Äì2‚Äì6</span>
          <button class="btn" id="toCalendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Üí</button>
        </div>

        <div class="card breath">
          <div class="circle" id="circle"></div>
          <div class="timer" id="timer">03:00</div>
          <div class="hint" id="phase">–ì–æ—Ç–æ–≤—ã? –ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª</div>
          <div class="row" style="gap:10px">
            <button class="btn" id="start">–°—Ç–∞—Ä—Ç</button>
            <button class="btn" id="pause">–ü–∞—É–∑–∞</button>
            <button class="btn" id="reset">–°–±—Ä–æ—Å</button>
          </div>
        </div>
      </section>

      <!-- –≠–∫—Ä–∞–Ω 3: –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
      <section class="screen" aria-label="–ö–∞–ª–µ–Ω–¥–∞—Ä—å">
        <div class="row">
          <button class="btn" id="back2">‚Üê –ú–µ–¥–∏—Ç–∞—Ü–∏—è</button>
          <span class="chip" id="monthLabel">‚Äî</span>
        </div>

        <div class="cal card">
          <div class="row">
            <div class="subtitle">–û—Ç–º–µ—Ç—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</div>
            <div class="row">
              <button class="btn" id="prevM">‚Äπ</button>
              <button class="btn" id="nextM">‚Ä∫</button>
            </div>
          </div>

          <div class="grid">
            <div class="dow">–ü–ù</div><div class="dow">–í–¢</div><div class="dow">–°–†</div>
            <div class="dow">–ß–¢</div><div class="dow">–ü–¢</div><div class="dow">–°–ë</div><div class="dow">–í–°</div>
          </div>
          <div class="grid" id="days"></div>
        </div>

        <div class="card editor">
          <div class="subtitle">–î–∞—Ç–∞: <span id="selectedDate">‚Äî</span></div>
          <div class="mood-row">
            <button class="mood" data-mood="good">üòä –•–æ—Ä–æ—à–æ</button>
            <button class="mood" data-mood="ok">üòê –ù–æ—Ä–º–∞–ª—å–Ω–æ</button>
            <button class="mood" data-mood="bad">üòû –ü–ª–æ—Ö–æ</button>
          </div>
          <textarea id="note" placeholder="–ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–º–µ—Ç–∫–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
          <button class="btn save" id="save">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
      </section>
    </div>

    <!-- –±–æ–ª—å—à–∞—è –∫—Ä—É–≥–ª–∞—è –∫–Ω–æ–ø–∫–∞ ¬´–¥–∞–ª–µ–µ¬ª –¥–ª—è 1-–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
    <button class="fab" id="fab" aria-label="–î–∞–ª–µ–µ">‚Üí</button>
  </div>

<script>
  // ===== —É—Ç–∏–ª–∏—Ç—ã =====
  const $  = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const appEl = document.getElementById('app');     // <‚Äî –ë–´–õ–û –û–¢–°–£–¢–°–¢–í–ò–ï, –∏–∑-–∑–∞ —ç—Ç–æ–≥–æ –≤—Å—ë ¬´–ª–æ–º–∞–ª–æ—Å—å¬ª
  const carousel = document.getElementById('carousel');
  const fab = document.getElementById('fab');

  const state = {
    screen: 0, timerSec: 180, running:false, phase:'idle',
    monthOffset:0, selected:new Date()
  };
  const fmt2 = n => String(n).padStart(2,'0');
  const fmtTime = s => `${fmt2(Math.floor(s/60))}:${fmt2(s%60)}`;
  const ymd = d => {
    const z = new Date(d.getFullYear(), d.getMonth(), d.getDate());
    return `${z.getFullYear()}-${fmt2(z.getMonth()+1)}-${fmt2(z.getDate())}`;
  };

  // ===== –Ω–∞–≤–∏–≥–∞—Ü–∏—è / —Å–≤–∞–π–ø—ã =====
  function go(i){
    state.screen = Math.max(0, Math.min(2, i));
    carousel.style.transform = `translateX(-${state.screen*100}%)`;
    fab.style.display = state.screen===0 ? 'grid' : 'none';
  }
  fab.addEventListener('click', ()=>go(1));
  $('#back1').addEventListener('click', ()=>go(0));
  $('#toCalendar').addEventListener('click', ()=>go(2));
  $('#back2').addEventListener('click', ()=>go(1));

  // —Å–≤–∞–π–ø—ã
  let startX=null, locked=false;
  const touch = e => e.changedTouches ? e.changedTouches[0] : e;
  appEl.addEventListener('touchstart',  e => { startX = touch(e).clientX }, {passive:true});
  appEl.addEventListener('touchmove',   e => {
    if(startX==null || locked) return;
    const dx = touch(e).clientX - startX;
    if(Math.abs(dx)>60){ locked = true; if(dx<0) go(state.screen+1); else go(state.screen-1);
      setTimeout(()=>locked=false, 320); }
  }, {passive:true});
  appEl.addEventListener('touchend',    ()=> startX=null);

  // ===== –º–µ–¥–∏—Ç–∞—Ü–∏—è =====
  const T_IN=4, T_HOLD=2, T_OUT=6;
  let tInterval=null, phaseT=0;
  const circle=$('#circle'), timer=$('#timer'), phase=$('#phase');

  function setPhase(p){
    state.phase=p; phaseT = (p==='inhale'?T_IN : p==='hold'?T_HOLD : T_OUT);
    phase.textContent = p==='inhale'?'–í–¥–æ—Ö–Ω–∏—Ç–µ‚Ä¶'
      : p==='hold' ? '–ó–∞–¥–µ—Ä–∂–∏—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ‚Ä¶'
      : '–ú–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥—ã—Ö–∞–π—Ç–µ‚Ä¶';
    circle.classList.toggle('grow', p!=='exhale');
  }
  function nextPhase(){
    if(state.phase==='idle') setPhase('inhale');
    else if(state.phase==='inhale') setPhase('hold');
    else if(state.phase==='hold') setPhase('exhale');
    else setPhase('inhale');
  }
  function tick(){
    if(!state.running) return;
    if(state.timerSec<=0){ stop(); phase.textContent='–ì–æ—Ç–æ–≤–æ! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞.'; return; }
    timer.textContent = fmtTime(state.timerSec);
    if(--phaseT<=0) nextPhase();
    state.timerSec--;
  }
  function start(){
    if(state.running) return;
    state.running=true; if(state.phase==='idle') nextPhase();
    tInterval = setInterval(tick, 1000);
  }
  function stop(){ state.running=false; clearInterval(tInterval); }
  function reset(){ stop(); state.timerSec=180; state.phase='idle';
    timer.textContent=fmtTime(state.timerSec); phase.textContent='–ì–æ—Ç–æ–≤—ã? –ù–∞–∂–º–∏—Ç–µ ¬´–°—Ç–∞—Ä—Ç¬ª'; circle.classList.remove('grow') }

  $('#start').addEventListener('click', start);
  $('#pause').addEventListener('click', stop);
  $('#reset').addEventListener('click', reset);
  timer.textContent = fmtTime(state.timerSec);

  // ===== –∫–∞–ª–µ–Ω–¥–∞—Ä—å / –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ =====
  const monthLabel = $('#monthLabel');
  const daysWrap   = $('#days');
  const selectedDateLabel = $('#selectedDate');
  const noteEl     = $('#note');

  function loadMood(key){ try{ return JSON.parse(localStorage.getItem('mood:'+key)||'{}'); }catch(e){ return {}; } }
  function saveMood(key,obj){ localStorage.setItem('mood:'+key, JSON.stringify(obj)); }

  function monthInfo(offset){
    const base = new Date();
    const d = new Date(base.getFullYear(), base.getMonth()+offset, 1);
    const firstDow = (d.getDay()+6)%7; // –ø–Ω=0
    const days = new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();
    return {d,firstDow,days};
  }
  function paintMonth(){
    const {d,firstDow,days} = monthInfo(state.monthOffset);
    monthLabel.textContent = d.toLocaleDateString('ru-RU',{month:'long',year:'numeric'});
    daysWrap.innerHTML='';
    for(let i=0;i<firstDow;i++) daysWrap.appendChild(document.createElement('div'));

    const todayKey = ymd(new Date());
    for(let day=1; day<=days; day++){
      const cell=document.createElement('button'); cell.type='button'; cell.className='day';
      const cur = new Date(d.getFullYear(), d.getMonth(), day);
      const key = ymd(cur);
      cell.textContent = day;
      if(key===todayKey) cell.classList.add('today');

      const stored = loadMood(key);
      if(stored.mood){
        const dot=document.createElement('div'); dot.className='dot';
        dot.classList.add(stored.mood==='good'?'mood-good':stored.mood==='ok'?'mood-ok':'mood-bad');
        cell.appendChild(dot);
      }
      cell.addEventListener('click', ()=>{
        state.selected=cur;
        selectedDateLabel.textContent = cur.toLocaleDateString('ru-RU',{day:'numeric',month:'long',year:'numeric'});
        noteEl.value = stored.note||'';
        [...daysWrap.querySelectorAll('.day')].forEach(d=>d.style.opacity='.6'); cell.style.opacity='1';
      });
      daysWrap.appendChild(cell);
    }
    const todayBtn = daysWrap.querySelector('.day.today'); if(todayBtn) todayBtn.click();
  }
  $('#prevM').addEventListener('click', ()=>{ state.monthOffset--; paintMonth(); });
  $('#nextM').addEventListener('click', ()=>{ state.monthOffset++; paintMonth(); });
  paintMonth();

  $$('.mood').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      $$('.mood').forEach(b=>b.style.outline='none');
      btn.style.outline='2px solid #fff';
      $('#save').dataset.mood = btn.dataset.mood;
    });
  });
  $('#save').addEventListener('click', ()=>{
    const key = ymd(state.selected);
    const mood = $('#save').dataset.mood || 'ok';
    const note = noteEl.value.trim();
    saveMood(key,{mood,note}); paintMonth();
    alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ');
  });

  // –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ (GitHub Pages)
  document.addEventListener('keydown', e=>{
    if(e.key==='ArrowRight') go(state.screen+1);
    if(e.key==='ArrowLeft')  go(state.screen-1);
    if(e.key===' ') start();
  });
</script>
</body>
</html>
